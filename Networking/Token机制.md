# Token机制

## 一、HTTP在身份认证中的不足
由于HTTP是一种没有状态的协议，它并不知道是谁访问了我们的应用。这里把用户看成是客户端，客户端使用用户名和密码通过了身份验证，下次这个客户端再发送请求的时候，还得再验证一下。

## 二、Cookie+Session方法
通用的解决方式是，当用户请求登陆的时候，如果没有问题，在服务器端生成一条记录，在这条记录里可以说明登陆的用户是谁，然后把这条记录的id发送给客户端，客户端收到以后把这个id存储在cookie里，下次该用户再次向服务器放松请求的时候，可以带上这个cookie，这样服务器会验证一下cookie里面的信息，看能不能在服务器端这里找到对应的记录，如果可以，说明用户已经通过了身份验证，就把用户请求的数据返回给客户端。
以上所描述的过程就是利用session，那个id值就是sessionid。我们需要在服务器端存储为用户生成的session，这些session会存储在内存、磁盘或者数据库。

## 三、Session的不足
1. 移动设备支持不足
2. 增加服务器开销
3. 制约系统的可扩展性

## 四、Token机制的引入
session机制的关键在于，我需要保存session，才能完成用户身份的认证。有没有办法不保存这些sessionid就可以完成身份的验证呢？Token就是这样一种机制，基于某种加密算法，为访问的用户生成唯一的一组序列，这个序列需要加密以保证安全性。用户再次访问的时候，携带此Token过来，服务器端基于同样的方法解密Token，就可以同样实现验证的功能。

## 五、基于Token的验证过程
1. 用户通过用户名和密码发送请求
2. 程序验证
3. 程序返回一个签名的token给客户端
4. 客户端存储token，并且用于每次发送请求
5. 服务器端验证token并返回结果（请求数据或错误码）
每一次请求都需要token。Token应该在HTTP的头部发送从而保证了Http请求无状态。我们同样通过设置服务器属性Access-Control-Allow-Origin:* ，让服务器接受到来自所有域的请求。需要注意的是，在ACAO头部标明（designating）时，不得带有像HTTP认证，客户端SSL证书和cookie的证书。

## 六、Token的优势
1. 无状态、可扩展
在客户端存储的Token是无状态的，并且能够被扩展。基于这种无状态和不存储Session信息，负载均衡器能够将用户信息从一个服务传到其他服务器上。
2. 安全性
请求中发送token而不再是发送cookie能够防止CSRF（跨站请求伪造）。即使在客户端中使用cookie存储token，cookie也仅仅是一个存储机制而不是用于认证。
3. 多平台跨域
