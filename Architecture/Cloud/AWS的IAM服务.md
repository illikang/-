# AWS的IAM服务

## 一、什么是IAM服务
IAM：Identity and Access Management

IAM服务通过AWS API提供身份认证与授权所需要的一切。IAM是如何借助AWS API来提供身份认证与授权功能的呢？因为客户通过AWS API发送的每个请求都会通过IAM来检查这个请求是否被允许。IAM控制在你的AWS账户里，谁（身份认证）能做什么（授权），例如：谁被允许创建EC2实例？用户是否被允许终止一个特定的EC2实例。

## 二、如何使用IAM完成身份认证和授权
使用IAM进行身份认证是通过用户和角色完成的，而授权是通过策略完成的。下表展示了用户和角色的区别：

|      | root用户     | IAM用户     | IAM角色    |
| :------------- | :------------- |:------------- |:------------- |
| 可以有一个密码       | 总是      |是     |否     |
| 可以有一个访问密钥      | 是（不推荐）      |是       |否      |
| 可以属于一个组      | 否       |是      |否      |
| 可以与一个EC2实例关联      | 否      | 否       |是      |

角色认证一个EC2实例，而用户可以用于其他一切。

### 用于授权的策略
每个策略在JSON中定义且包含一个或多个声明。一个声明可以允许或拒绝在特定资源上做特定操作。用户可以在AWS官网找到可用于EC2资源的所有操作的概览。通配符*可以被用来创建更通用的声明。

### 用于身份认证的用户和用于组织用户的组
一个用户可以被密码或访问密钥所认证。当用户登录到管理控制台，用户是通过密码认证的。如果你在计算机中使用了CLI，就可以使用一个访问密钥来认证已创建的用户。

按照AWS安全策略，客户应该使用MFA保护root用户，然后停止使用root用户。因为使用最小权限总是个好主意，客户必然将为管理控制台创建一个新用户来管理系统。为了将来添加用户更容易，首先要为所有管理员用户创建一个组。一个组不能被用来作为身份认证，但它集中了授权。如果想阻止管理员用户终止EC2服务器，只需要修改这个组的策略，而不是所有管理员用户的策略。一个用户可以不是任何组的成员，也可以是一个或多个组的成员。

使用CLI创建用户组“admin”和用户“myuser”
```
$ aws iam create-group --group-name "admin"
$ aws iam attach-group-policy --group-name "admin" --policy-arn "arn:aws:iam::aws:policy/AdministratorAccess"
$ aws iam create-user --user-name "myuser"
$ aws iam add-user-to-group --group-name "admin" --user-name "myuser"
$ aws iam create-login-profile --user-name "myuser" --password "Wka4562354"
```
用户myuser已经准备好可以使用了。但是，如果不是使用root用户的话，则必须使用一个不同的URL来访问管理控制台，即http://$accountId.signin.aws.amazon.com/console。用之前使用aws iam get-user提取的账户ID替换$accountId。
### 用于认证AWS的角色

## 三、实例：创建用户、用户组并管理用户权限

## 四、通过IAM理解云服务的权限机制

### 用Linux系统类比AWS
1. 我们可以把整个AWS看作一台虚拟系统，系统中提供了所有的AWS服务。类比于Linux系统。
2. 而在AWS官网注册并通过Web控制台登陆的账户就是这个系统的root账户。类似于用root账户登录了Linux系统。
3. 一个用户可以被密码或密钥所认证。类似于直接用密码登陆Linux系统（密码认证）和基于SSH远程登陆（密钥认证）。
4. 当用户登陆到管理控制台时，用户是通过密码认证的。
5. 如果在计算机中使用了CLI，就可以使用一个访问密钥来认证已创建的用户。
6. 就像Linux服务器一样，用root用户操作系统的风险很高，直接用root账户管理AWS也是非常危险的。因此，AWS的安全策略中建议使用多重身份验证（MFA）来保护root用户，然后停止使用root用户，创建一个新的用户，授予较小的权限，用于日常操作。这与我们在Linux系统中创建用户和用户组来实现权限管理是一个道理。
